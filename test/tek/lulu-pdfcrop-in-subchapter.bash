#include "tempdir.bash"

TEKARGS="main.tex"

cat >main.tex <<"EOF"
\documentclass{article}
\usepackage{graphicx}
\begin{document}

% the following is a supported include
\input{chapter.stex}

% the following is a not-supported include
\input{chapters/chapter.stex}

\end{document}
EOF

cat >chapter.tex <<"EOF"
\documentclass{article}
\usepackage{graphicx}
\begin{document}
This is a sample chapter
\end{document}
EOF

mkdir chapters
cat >chapters/chapter.tex<<"EOF"
\documentclass{article}
\usepackage{graphicx}
\begin{document}
This is a sample chapter
\includegraphics{figure.uncrop.pdf}
\end{document}
EOF

cat >chapters/figure.uncrop.pdf.gz.b64 <<"EOF"
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
ewkfAAA=
EOF
cat chapters/figure.uncrop.pdf.gz.b64 | base64 -d | gzip -dc > chapters/figure.uncrop.pdf

#include "harness.bash"
